<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ETF 定期定額複利試算｜每月投資報酬計算機</title>
  <link rel="stylesheet" href="style.css">
</head>
<body onload="calculate()">
  <div class="container">
    <h1>ETF 定期定額複利試算</h1>

    <label>每月投入金額（NTD）</label>
    <input id="monthly" type="number" value="10000">

    <label>年化報酬率（%）</label>
    <input id="rate" type="number" value="6">

    <label>投資年數</label>
    <input id="years" type="number" value="20">

    <button onclick="calculate()">開始試算</button>

    <!-- 圖表區塊 -->
    <canvas id="chart" width="600" height="300"></canvas>

    <div class="result" id="result"></div>

    <footer>※ 本試算僅為數學模擬，非投資建議</footer>
  </div>

  <script>
    function calculate() {
      const monthly = Number(document.getElementById('monthly').value);
      const rate = Number(document.getElementById('rate').value) / 100 / 12;
      const years = Number(document.getElementById('years').value);

      if (years <= 0) {
        alert('投資年數需大於 0');
        return;
      }

      const months = years * 12;
      let value = 0;
      const yearly = [];

      for (let i = 1; i <= months; i++) {
        value = (value + monthly) * (1 + rate);
        if (i % 12 === 0) yearly.push(Math.round(value));
      }

      const invested = monthly * months;

      document.getElementById('result').innerHTML = `
        <p><strong>總投入：</strong> NT$ ${invested.toLocaleString()}</p>
        <p><strong>最終資產：</strong> NT$ ${Math.round(value).toLocaleString()}</p>
        <p><strong>投資收益：</strong> NT$ ${Math.round(value - invested).toLocaleString()}</p>
      `;

      drawChart(yearly);
    }

    function drawChart(data) {
      const c = document.getElementById('chart');
      const ctx = c.getContext('2d');
      ctx.clearRect(0, 0, c.width, c.height);

      const max = Math.max(...data);
      const padding = 40;

      // 畫座標軸
      ctx.strokeStyle = "#94a3b8";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, c.height - padding);
      ctx.lineTo(c.width - padding, c.height - padding);
      ctx.stroke();

      // 畫折線 + 圓點
      ctx.beginPath();
      data.forEach((v, i) => {
        const x = padding + (i / (data.length - 1)) * (c.width - padding * 2);
        const y = c.height - padding - (v / max) * (c.height - padding * 2);
        if (i === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
        // 畫圓點
        ctx.fillStyle = "#2563eb";
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
      });
      ctx.strokeStyle = "#2563eb";
      ctx.lineWidth = 2;
      ctx.stroke();

      // 漸層填充區域
      const gradient = ctx.createLinearGradient(0, padding, 0, c.height - padding);
      gradient.addColorStop(0, "rgba(37,99,235,0.3)");
      gradient.addColorStop(1, "rgba(37,99,235,0)");
      ctx.fillStyle = gradient;
      ctx.lineTo(c.width - padding, c.height - padding);
      ctx.lineTo(padding, c.height - padding);
      ctx.closePath();
      ctx.fill();
    }
  </script>
</body>
</html>
