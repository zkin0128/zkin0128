<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ETF å®šæœŸå®šé¡è¤‡åˆ©è©¦ç®—ï½œè¨Šä¸ç§‘æŠ€ç†è²¡å·¥å…·</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body onload="calculate()">
  <nav class="navbar">
    <div class="nav-logo">ğŸŒ¿è¨Šä¸ç§‘æŠ€ ç†è²¡å·¥å…·</div>
    <div class="nav-links">
      <a href="#calculator">è©¦ç®—</a>
      <a href="#stock">è‚¡ç¥¨è³‡è¨Š</a>
      <a href="#download">ä¸‹è¼‰åœ–è¡¨</a>
      <a href="#" onclick="toggleDarkMode()">ğŸŒ“</a>
    </div>
  </nav>

  <div class="container" id="calculator">
    <h1>ETF å®šæœŸå®šé¡è¤‡åˆ©è©¦ç®—</h1>
    <p class="subtitle">è¨Šä¸ç§‘æŠ€ç”¨æ•¸æ“šçœ‹è¦‹ä½ çš„è²¡å¯Œæœªä¾† ğŸŒ±</p>

    <label>æ¯æœˆæŠ•å…¥é‡‘é¡ï¼ˆNTDï¼‰</label>
    <input id="monthly" type="number" value="10000">

    <label>å¹´åŒ–å ±é…¬ç‡ï¼ˆ%ï¼‰</label>
    <input id="rate" type="number" value="6">

    <label>æŠ•è³‡å¹´æ•¸</label>
    <input id="years" type="number" value="20">

    <button onclick="calculate()">é–‹å§‹è©¦ç®—</button>

    <canvas id="chart" height="300"></canvas>
    <div class="result" id="result"></div>
  </div>

  <section class="stock-link" id="stock">
    <h2>å¿«é€ŸæŸ¥çœ‹è‚¡ç¥¨è³‡è¨Š</h2>
    <label>è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼ˆä¾‹å¦‚ï¼š2330ï¼‰</label>
    <input type="text" id="stockCode" placeholder="è«‹è¼¸å…¥å°è‚¡ä»£ç¢¼">
    <button onclick="openYahoo()">å‰å¾€ Yahoo è‚¡å¸‚</button>
    <div class="hot-stocks">
      <button onclick="quickStock('0050')">0050</button>
      <button onclick="quickStock('2330')">2330</button>
      <button onclick="quickStock('00878')">00878</button>
    </div>
  </section>

  <section class="download" id="download">
    <h2>ä¸‹è¼‰åœ–è¡¨</h2>
    <button onclick="downloadChart()">ğŸ“¥ ä¸‹è¼‰åœ–è¡¨ç‚ºåœ–ç‰‡</button>
  </section>

  <footer>æœ¬è©¦ç®—åƒ…ç‚ºæ•¸å­¸æ¨¡æ“¬ï¼ŒéæŠ•è³‡å»ºè­°</footer>

  <script>
    let chart;

    function calculate() {
      const monthly = Number(document.getElementById('monthly').value);
      const rate = Number(document.getElementById('rate').value) / 100 / 12;
      const years = Number(document.getElementById('years').value);
      if (years <= 0) return alert('æŠ•è³‡å¹´æ•¸éœ€å¤§æ–¼ 0');

      const months = years * 12;
      let value = 0;
      const yearlyValue = [], yearlyInvested = [], labels = [];

      for (let i = 1; i <= months; i++) {
        value = (value + monthly) * (1 + rate);
        if (i % 12 === 0) {
          yearlyValue.push(Math.round(value));
          yearlyInvested.push(monthly * i);
          labels.push((i / 12) + "å¹´");
        }
      }

      const invested = monthly * months;
      document.getElementById('result').innerHTML = `
        <p><strong>ç¸½æŠ•å…¥ï¼š</strong> NT$ ${invested.toLocaleString()}</p>
        <p><strong>æœ€çµ‚è³‡ç”¢ï¼š</strong> NT$ ${Math.round(value).toLocaleString()}</p>
        <p><strong>æŠ•è³‡æ”¶ç›Šï¼š</strong> NT$ ${(value - invested).toLocaleString(undefined, {maximumFractionDigits: 0})}</p>
      `;

      drawChart(labels, yearlyValue, yearlyInvested);
    }

    function drawChart(labels, valueData, investedData) {
      const ctx = document.getElementById('chart').getContext('2d');

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'è³‡ç”¢æˆé•·',
              data: valueData,
              borderColor: '#38a169',
              backgroundColor: 'rgba(56,161,105,0.2)',
              fill: true,
              tension: 0.3,
              pointRadius: 4
            },
            {
              label: 'ç¸½æŠ•å…¥',
              data: investedData,
              borderColor: '#b7791f',
              backgroundColor: 'rgba(183,121,31,0.2)',
              fill: true,
              tension: 0.3,
              pointRadius: 4
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.dataset.label}: NT$ ${context.parsed.y.toLocaleString()}`;
                }
              }
            },
            legend: {
              labels: {
                color: getComputedStyle(document.body).color
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'NT$ ' + value.toLocaleString();
                },
                color: getComputedStyle(document.body).color
              },
              grid: {
                color: 'rgba(200,200,200,0.2)'
              }
            },
            x: {
              ticks: {
                color: getComputedStyle(document.body).color
              },
              grid: {
                color: 'rgba(200,200,200,0.1)'
              }
            }
          }
        }
      });
    }

    function openYahoo() {
      const code = document.getElementById("stockCode").value.trim();
      if (!code) {
        alert("è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼");
        return;
      }
      const url = `https://tw.stock.yahoo.com/quote/${code}.TW`;
      window.open(url, "_blank");
    }

    function quickStock(code) {
      document.getElementById("stockCode").value = code;
      openYahoo();
    }

    function downloadChart() {
      const canvas = document.getElementById("chart");
      const link = document.createElement("a");
      link.download = "etf_chart.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
      if (chart) chart.options.plugins.legend.labels.color = getComputedStyle(document.body).color;
      if (chart) {
        chart.options.scales.x.ticks.color = getComputedStyle(document.body).color;
        chart.options.scales.y.ticks.color = getComputedStyle(document.body).color;
        chart.update();
      }
    }
  </script>
</body>
</html>
