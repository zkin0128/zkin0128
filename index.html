<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ETF 定期定額複利試算｜每月投資報酬計算機</title>
  <link rel="stylesheet" href="style.css">
</head>
<body onload="calculate()">
  <div class="container">
    <h1>ETF 定期定額複利試算</h1>

    <label>每月投入金額（NTD）</label>
    <input id="monthly" type="number" value="10000">

    <label>年化報酬率（%）</label>
    <input id="rate" type="number" value="6">

    <label>投資年數</label>
    <input id="years" type="number" value="20">

    <button onclick="calculate()">開始試算</button>

    <canvas id="chart" width="600" height="300"></canvas>
    <div id="tooltip" class="tooltip"></div>

    <div class="result" id="result"></div>

    <footer>※ 本試算僅為數學模擬，非投資建議</footer>
  </div>

  <script>
    let points = [];

    function calculate() {
      const monthly = Number(document.getElementById('monthly').value);
      const rate = Number(document.getElementById('rate').value) / 100 / 12;
      const years = Number(document.getElementById('years').value);

      if (years <= 0) {
        alert('投資年數需大於 0');
        return;
      }

      const months = years * 12;
      let value = 0;
      const yearlyValue = [];
      const yearlyInvested = [];

      for (let i = 1; i <= months; i++) {
        value = (value + monthly) * (1 + rate);
        if (i % 12 === 0) {
          yearlyValue.push(Math.round(value));
          yearlyInvested.push(monthly * i);
        }
      }

      const invested = monthly * months;

      document.getElementById('result').innerHTML = `
        <p><strong>總投入：</strong> NT$ ${invested.toLocaleString()}</p>
        <p><strong>最終資產：</strong> NT$ ${Math.round(value).toLocaleString()}</p>
        <p><strong>投資收益：</strong> NT$ ${Math.round(value - invested).toLocaleString()}</p>
      `;

      drawChart(yearlyValue, yearlyInvested);
    }

    function drawChart(valueData, investedData) {
      const c = document.getElementById('chart');
      const ctx = c.getContext('2d');
      ctx.clearRect(0, 0, c.width, c.height);
      points = [];

      const max = Math.max(...valueData, ...investedData);
      const padding = 50;

      // 座標軸與刻度
      ctx.strokeStyle = "#94a3b8";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, c.height - padding);
      ctx.lineTo(c.width - padding, c.height - padding);
      ctx.stroke();

      ctx.fillStyle = "#475569";
      ctx.font = "12px Arial";
      const steps = 5;
      for (let i = 0; i <= steps; i++) {
        const value = Math.round(max * i / steps);
        const y = c.height - padding - (i / steps) * (c.height - padding * 2);
        ctx.fillText("NT$ " + value.toLocaleString(), 5, y + 4);
        ctx.beginPath();
        ctx.moveTo(padding - 5, y);
        ctx.lineTo(c.width - padding, y);
        ctx.strokeStyle = "#e2e8f0";
        ctx.stroke();
      }

      const years = valueData.length;
      for (let i = 0; i < years; i++) {
        const x = padding + (i / (years - 1)) * (c.width - padding * 2);
        const y = c.height - padding;
        ctx.fillText((i + 1) + "年", x - 10, y + 20);
      }

      // 資產成長折線
      ctx.beginPath();
      valueData.forEach((v, i) => {
        const x = padding + (i / (valueData.length - 1)) * (c.width - padding * 2);
        const y = c.height - padding - (v / max) * (c.height - padding * 2);
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        ctx.fillStyle = "#2563eb";
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
        points.push({x, y, value: v, label: (i+1)+"年 資產"});
      });
      ctx.strokeStyle = "#2563eb";
      ctx.lineWidth = 2;
      ctx.stroke();

      // 總投入折線
      ctx.beginPath();
      investedData.forEach((v, i) => {
        const x = padding + (i / (investedData.length - 1)) * (c.width - padding * 2);
        const y = c.height - padding - (v / max) * (c.height - padding * 2);
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        ctx.fillStyle = "#f97316";
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
        points.push({x, y, value: v, label: (i+1)+"年 投入"});
      });
      ctx.strokeStyle = "#f97316";
      ctx.lineWidth = 2;
      ctx.stroke();

      // 圖例
      ctx.fillStyle = "#2563eb";
      ctx.fillRect(c.width - 120, padding, 12, 12);
      ctx.fillStyle = "#000";
      ctx.fillText("資產成長", c.width - 100, padding + 10);

      ctx.fillStyle = "#f97316";
      ctx.fillRect(c.width - 120, padding + 20, 12, 12);
      ctx.fillStyle = "#000";
      ctx.fillText("總投入", c.width - 100, padding + 30);

      // Tooltip 互動
      c.onmousemove = function(e) {
        const rect = c.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        const tooltip = document.getElementById("tooltip");
        let found = false;
        points.forEach(p => {
          if (Math.abs(mouseX - p.x) < 6 && Math.abs(mouseY - p.y) < 6) {
            tooltip.style.left = (e.clientX + 10) + "px";
            tooltip.style.top = (e.clientY - 20) + "px";
            tooltip.innerHTML = p.label + ": NT$ " + p.value.toLocaleString();
            tooltip.style.display = "block";
            found = true;
          }
        });
        if (!found) {
          tooltip.style.display = "none";
        }
      };
    }
  </script>
</body>
</html>
