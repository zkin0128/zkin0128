<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ETF å®šæœŸå®šé¡è¤‡åˆ©è©¦ç®—ï½œè¨Šä¸ç§‘æŠ€ç†è²¡å·¥å…·</title>
  <link rel="stylesheet" href="style.css">
</head>
<body onload="calculate()">
  <nav class="navbar">
    <div class="nav-logo">ğŸŒ¿è¨Šä¸ç§‘æŠ€ ç†è²¡å·¥å…·</div>
    <div class="nav-links">
      <a href="#calculator">è©¦ç®—</a>
      <a href="#stock">è‚¡ç¥¨è³‡è¨Š</a>
      <a href="#download">ä¸‹è¼‰åœ–è¡¨</a>
      <a href="#" onclick="toggleDarkMode()">ğŸŒ“</a>
    </div>
  </nav>

  <div class="container" id="calculator">
    <h1>ETF å®šæœŸå®šé¡è¤‡åˆ©è©¦ç®—</h1>
    <p class="subtitle">è¨Šä¸ç§‘æŠ€ç”¨æ•¸æ“šçœ‹è¦‹ä½ çš„è²¡å¯Œæœªä¾† ğŸŒ±</p>

    <label>æ¯æœˆæŠ•å…¥é‡‘é¡ï¼ˆNTDï¼‰</label>
    <input id="monthly" type="number" value="10000">

    <label>å¹´åŒ–å ±é…¬ç‡ï¼ˆ%ï¼‰</label>
    <input id="rate" type="number" value="6">

    <label>æŠ•è³‡å¹´æ•¸</label>
    <input id="years" type="number" value="20">

    <button onclick="calculate()">é–‹å§‹è©¦ç®—</button>

    <canvas id="chart" width="600" height="300"></canvas>
    <div id="tooltip" class="tooltip"></div>

    <div class="result" id="result"></div>
  </div>

  <section class="stock-link" id="stock">
    <h2>å¿«é€ŸæŸ¥çœ‹è‚¡ç¥¨è³‡è¨Š</h2>
    <label>è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼ˆä¾‹å¦‚ï¼š2330ï¼‰</label>
    <input type="text" id="stockCode" placeholder="è«‹è¼¸å…¥å°è‚¡ä»£ç¢¼">
    <button onclick="openYahoo()">å‰å¾€ Yahoo è‚¡å¸‚</button>
    <div class="hot-stocks">
      <button onclick="quickStock('0050')">0050</button>
      <button onclick="quickStock('2330')">2330</button>
      <button onclick="quickStock('00878')">00878</button>
    </div>
  </section>

  <section class="download" id="download">
    <h2>ä¸‹è¼‰åœ–è¡¨</h2>
    <button onclick="downloadChart()">ğŸ“¥ ä¸‹è¼‰åœ–è¡¨ç‚ºåœ–ç‰‡</button>
  </section>

  <footer>æœ¬è©¦ç®—åƒ…ç‚ºæ•¸å­¸æ¨¡æ“¬ï¼ŒéæŠ•è³‡å»ºè­°</footer>

  <script>
    let points = [];

    function calculate() {
      const monthly = Number(document.getElementById('monthly').value);
      const rate = Number(document.getElementById('rate').value) / 100 / 12;
      const years = Number(document.getElementById('years').value);
      if (years <= 0) return alert('æŠ•è³‡å¹´æ•¸éœ€å¤§æ–¼ 0');

      const months = years * 12;
      let value = 0;
      const yearlyValue = [], yearlyInvested = [];

      for (let i = 1; i <= months; i++) {
        value = (value + monthly) * (1 + rate);
        if (i % 12 === 0) {
          yearlyValue.push(Math.round(value));
          yearlyInvested.push(monthly * i);
        }
      }

      const invested = monthly * months;
      document.getElementById('result').innerHTML = `
        <p><strong>ç¸½æŠ•å…¥ï¼š</strong> NT$ ${invested.toLocaleString()}</p>
        <p><strong>æœ€çµ‚è³‡ç”¢ï¼š</strong> NT$ ${Math.round(value).toLocaleString()}</p>
        <p><strong>æŠ•è³‡æ”¶ç›Šï¼š</strong> NT$ ${(value - invested).toLocaleString(undefined, {maximumFractionDigits: 0})}</p>
      `;
      drawChart(yearlyValue, yearlyInvested);
    }

    function drawChart(valueData, investedData) {
      const c = document.getElementById('chart');
      const ctx = c.getContext('2d');
      ctx.clearRect(0, 0, c.width, c.height);
      points = [];

      const max = Math.max(...valueData, ...investedData);
      const padding = 50;

      ctx.strokeStyle = "#94a3b8";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, c.height - padding);
      ctx.lineTo(c.width - padding, c.height - padding);
      ctx.stroke();

      ctx.fillStyle = "#475569";
      ctx.font = "12px Arial";
      for (let i = 0; i <= 5; i++) {
        const value = Math.round(max * i / 5);
        const y = c.height - padding - (i / 5) * (c.height - padding * 2);
        ctx.fillText("NT$ " + value.toLocaleString(), 5, y + 4);
        ctx.beginPath();
        ctx.moveTo(padding - 5, y);
        ctx.lineTo(c.width - padding, y);
        ctx.strokeStyle = "#e2e8f0";
        ctx.stroke();
      }

      const years = valueData.length;
      for (let i = 0; i < years; i++) {
        const x = padding + (i / (years - 1)) * (c.width - padding * 2);
        const y = c.height - padding;
        ctx.fillText((i + 1) + "å¹´", x - 10, y + 20);
      }

      ctx.beginPath();
      valueData.forEach((v, i) => {
        const x = padding + (i / (valueData.length - 1)) * (c.width - padding * 2);
        const y = c.height - padding - (v / max) * (c.height - padding * 2);
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        ctx.fillStyle = "#38a169";
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
        points.push({x, y, value: v, label: (i+1)+"å¹´ è³‡ç”¢"});
      });
      ctx.strokeStyle = "#38a169";
      ctx.lineWidth = 2;
      ctx.stroke();

      ctx.beginPath();
      investedData.forEach((v, i) => {
        const x = padding + (i / (investedData.length - 1)) * (c.width - padding * 2);
        const y = c.height - padding - (v / max) * (c.height - padding * 2);
        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        ctx.fillStyle = "#b7791f";
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
        points.push({x, y, value: v, label: (i+1)+"å¹´ æŠ•å…¥"});
      });
      ctx.strokeStyle = "#b7791f";
      ctx.lineWidth = 2;
      ctx.stroke();

      c.onmousemove = function(e) {
        const rect = c.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        const tooltip = document.getElementById("tooltip");
        let found = false;
        points.forEach(p => {
          if (Math.abs(mouseX - p.x) < 6 && Math.abs(mouseY - p.y) < 6) {
            tooltip.style.left = (e.clientX + 10) + "px";
            tooltip.style.top = (e.clientY - 20) + "px";
            tooltip.innerHTML = p.label + ": NT$ " + p.value.toLocaleString();
            tooltip.style.display = "block";
            found = true;
          }
        });
        if (!found) tooltip.style.display = "none";
      };
    }

    function openYahoo() {
      const code = document.getElementById("stockCode").value.trim();
      if (!code) {
        alert("è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ï¼");
        return;
      }
      const url = `https://tw.stock.yahoo.com/quote/${code}.TW`;
      window.open(url, "_blank");
    }

    function quickStock(code) {
      document.getElementById("stockCode").value = code;
      openYahoo();
    }

    function downloadChart() {
      const canvas = document.getElementById("chart");
      const link = document.createElement("a");
         link.download = "etf_chart.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }
  </script>
</body>
</html>
